

Tine TODO

Software:

	!!! DO NOT CHANGE list:
		-- RECORD TOGGLE's glyph and ERASE WHILE HELD's chord need to conflict, so that the file.sync() on ERASE WHILE HELD's key-up doesn't get skipped when toggling
			-- if the key-chord for ERASE WHILE HELD is changed, then the file.sync() call in unassignKey() must also be changed

	. prove I'm not a dipshit: actually finish the project

	-- restructured some functions in func_timer.ino

	. change SWING:
		. remove recordable SWING-commands
			-- done
		. change the UPPER CHANNEL BITS CmdFunc to exclude the block that was previously taken up by recordable SWING commands
			-- done
		. update data-key.txt accordingly
			-- done
		. remove table of constants related to SWING
			-- done
		. simplify the way tempo is calculated
			-- done
		. change SWING AMOUNT and SWING GRANULARITY CmdFuncs, to deal with 32nd-notes rather than abstract swing-values
			-- done
		. change files so that SGRAN and SAMOUNT are saved as global prefs, rather than per-file prefs
			-- done
		. actually just remove all remnants of SWING, SGRAN, and SAMOUNT, since this can't even be repurposed for recording without getting too hairy:
			. remove SGRAN/SAMOUNT vars
				-- done
			. remove SGRAN/SAMOUNT CmdFunc entries, and move other CmdFuncs to compensate
				-- done
			. remove SWING glyphs, and update manual glyph calls
				-- done
			. remove SWING-related top-row GUI events
				-- done
			. remove SWING CmdFuncs themselves
				-- done
			. remove SGRAN/SAMOUNT file-vars (P.DAT, functions that modify P.DAT, prefs-format.txt, etc)
				-- done
			. change button-key.txt to remove SWING commands
				-- done
		. add a global "OFFSET" var, to change QUANTIZE's base-point
			. add the OFFSET var itself
				-- done
			. change button-key.txt to add OFFSET
				-- done
			. add a CmdFunc entry for it, and move other CmdFuncs to compensate
				-- done
			. add an OFFSET glyph, and update manual glyph calls
				-- done
			. add an OFFSET-related top-row GUI event
				-- done
			. add the OFFSET CmdFunc itself in func_cmds.ino: OFFSET should also be bounded by QUANTIZE
				-- done
			. add OFFSET's functionality to the recording-mechanisms: positive or negative offset gets applied to the base QUANTIZE-point
				-- done
			. the logic that decides whether or not to play a note while recording in realtime, should also apply the OFFSET value
				-- no changes are necessary here, since processRecAction() checks only for presence on the current tick, in this regard
		. update timing system to be based on floats rather than integers
			-- done
	. test OFFSET system
		-- OFFSET didn't display its top-row GUI correctly. already fixed it
	. test again
		-- OFFSET doesn't get applied to REPEAT-notes
		. fix it
			-- REPEAT-notes get triggered on every 32nd-note
			. figure out why
				-- logic-flow error: getInsertionPoint() was checking for the absence of REPEAT, which interfered with the repeat-mechanism's boolean check
	. test again
		-- REPEAT works now, but OFFSET still isn't being applied
		. figure out what's going on
			-- everything is a morass. time to rewrite the OFFSET/QUANTIZE system again
	. rewrite the relevant portions of the OFFSET/QUANTIZE system
		-- ok
	. re-test OFFSET-REPEAT
		-- OFFSET only works when it contains a value of -2 or -1.
		. figure out why
			--
		-- also, OFFSET-REPEAT notes are playing an extra note, the tick after their correct note.
		. figure out why
			-- it was the goddamned testing apparatus
	. test OFFSET-QUANTIZE (no REPEAT) while recording notes
		--

	. save OFFSET to the PREFS-file
		--
	. load OFFSET when the PREFS are loaded
		--

	. add DURATION-HUMANIZE?
		--

	. test long-sequence timed cues and beatslicing
		--

	. test REPEAT-SWEEP on:
		. recording regular MIDI commands
			--
		. recording special MIDI commands
			--
		. recording BPM commands
			--

	. re-test all tricky recording mechanisms
		. ERASE WHILE HELD on TRACK 2
		. CLEAR SEQ clears notes in the correct size-window?
		. CLEAR SEQ clears both tracks simultaneously?
		. SEQ POSITION
		. SWITCH RECORDSEQ

	. reassign the RECORD-MODE control-commands to make logical sense (draw a chart to help with this, if necessary)
		. change button-key.txt:
			. RECORD, REPEAT, and TRACK should be conceptually connected
			. CHAN and UPPER-CHAN should be conceptually connected
			. OCTAVE, VELOCITY, DURATION, HUMANIZE, and QUANTIZE should be conceptually connected
		. change KEYTAB array for this
		. change RECORD-MODE GUI routines for this

	. re-test things
		. are old notes being knocked out of the sequence by new notes in RECORD-MODE properly?
		. test manual MIDI-OFF commands:
			. keystroke-based
			. recorded
		. test CC/PC/other advanced MIDI commands
			. with REPEAT-SWEEP active
			. with arpeggiation
		. test file-load
			. test sequence-position preservation on load
			. test this with oddly-shaped seqs, and seqs that will definitely wrap
		. test auto-loading of most recent savefile on startup
		. test that the number of the savefile is displayed correctly on startup
			. also for savefiles in file-slots >= 100

	. re-test all cue-commands
		. OFF
		. CUE
		. SLICE
		. CUE (with SLICE-offset insertion)
		. CUE OFF
		. PAGE OFF
		. SCATTER (amount)
		. SCATTER UNSET
		. PAGE SCATTER UNSET
		. double-pressed commands, of the same or different types, to check for unexpected behaviors

	. test LOAD MODE fully:
		. check toggling into/out of LOAD MODE from both PLAY MODE and RECORD MODE
			. PLAY MODE:
				. check toggling LOAD MODE when seqs are playing
				. check toggling LOAD MODE when seqs have active cued-commands
			. RECORD MODE:
				. check toggling LOAD MODE when RECORDNOTES is armed / when REPEAT is active / both
		. check that all possible edge-case sequences on all pages load correctly

	. test MIDI-IN (notes)
		. are notes recorded correctly in RECORD-MODE?
		. are notes recorded only when RECORDNOTES is armed?
		. make sure that notes are not erroneously recorded when PLAY MODE or LOAD MODE is active
			. especially after toggling into LOAD MODE from RECORD MODE with RECORDNOTES armed

	. reinsert a simple MIDI-IN (clock) system?

	. check whether sequences function correctly with non-multiple-of-2 lengths, under all RECORD MODE and PLAY MODE processes
	. check that, when a deeper savefile is loaded and is running many complex sequences, there's no extra lag for whatever reason
	. look at all note-recording routines again, to triple-check for any stupid mistakes that would lead to unnecessary wear
	. double-check that the BPM rate is actually accurate at various speeds
	. fill 12 sequences with notes, and check whether lag occurs when connected to a hardware synthesizer
	. does anything catastrophic happen when the SD-card is removed during regular operation?

	==== SOFTWARE BETA THRESHOLD ====

	. when the OFF button is used to wipe the cues from a cued seq, does that cued seq refrain from any activity correctly?
		. if a new cue is set for the same seq, as the seq's first action after such a situation, then does the cue act as expected?

	. when two note-buttons are simultaneously held during ARMED RECORDING, are they recorded simultaneously?
		. what if more than two are held?
		. what if they're CONTROL-CHANGES?
			. two held?
			. more than two?
		. what if they're PROGRAM-CHANGES?
			. two held?
			. more than two?

	. do very slow BPMs have the expected tick-length?
	. test whether very fast BPMs have any lag

	. double-check all functionality for sequences on the second-page

	. edge-case testing:
		. does RECORD MODE work right:
			. when the sequence is loaded with SCATTERs and CUEs?
			. in MIDI FOLLOW mode?
			. for sequences with a weird tempo/slice offset from the global cue?

	. survey all TO_UPDATE calls, for superfluous flags

	. add SONG POSITION POINTER functionality while in CLOCK FOLLOW mode, to orient the global cue-position correctly?

	. double-check that there are no remaining "todo" or "test" comments in the codebase
	. remove "THIS CODE IS UNDER DEVELOPMENT AND DOESN'T DO ANYTHING" from license-statement
	. double-check that everything compiles correctly in the latest version of Arduino
	. test overloading the 8-events-per-tick system
	. test overloading the SUSTAIN system with simultaneous sequencing and notes-from-RECORD-MODE
	. soak-test the physical prototype

	. add a note to tutorials on wear-leveling:
		. extreme repetitive use of note-insertion and CLEAR will lead to comparatively faster card degradation (~10 years, versus the card's natural material lifespan)

	. research how to back-up the contents of the SD-card in a manner that recombines the savefiles without losing their contiguous nature
		-- files could be copied off the disk manually, and then transferred back onto the disk file-by-file using XVI32 to paste their contents into blank files
		-- files could be copied en masse as a disk-image, and then reapplied en masse with a disk-imager
			. write a tutorial on both of these methods

Hardware:

	. clear/clean/update todo tasks
		--

	. check sizes of the pin-holes for the B3F-5050 buttons, and if they're too small, slightly widen them to compensate for kerf. (just remembered that these were too tight on the alpha prototype)
		--

	. update KiCad/Inkscape files:
		. both boards:
			. use connection-labels in the schematic, instead of having to make tangles of connections. faster revisions & reduces chance of overlooked errors
				-- am using this process now
			. move DC-IN jack and MIDI-ports to bottom-board
				-- done
				. change edge-cuts for both boards to accomodate the new DC-IN jack position
					-- done
			. add extra kerf to standoff-holes, to compensate for standoff screws always being slightly over-size due to their threading
				-- done: increased from 2.5mm to 2.75mm
			. change all stacking headers to occupy a 2x20 horizontal row between the buttons and LEDs, to make the assembly process less fragile
				. do this in schematic
					-- done
				. do this in PCBs
					. top-board
						-- done
					. bottom-board
						--
			. make sure stacking-headers have the same pin-positions, signifying the same pin-contents (keeping in mind that the top-board's header is reversed)
				--
			. move model-number text to bottom-board - if it were still on the top-board, any sort of transparent plexiglas would make it look tacky
				--
				. model-number text should be in the following format:
					. basilisk tine sequencer
					  production run number - production run name
			. make sure all edge-cuts reflect the rearrangement of ports/standoffs
				--
			. add edge-cuts to top-board for all electrolytic capacitors on the bottom-board
				-- done
				. double-check that the capacitors in the parts-list are actually slim enough to fit into this space
					--
			. double-check that ports aren't competing for space with standoffs
		. bottom-board:
			. update R-SET resistor's value based on the new diffused LEDs
				--
			. double-check all pin assignments on both regulators, comparing datasheets directly to footprints
				--
			. place thermal-plates that accomodate new smaller heatsinks
			. remember to include screw-holes inside the thermal-plates (these may be part of the regulators' footprints)
			. place all capacitors beneath edge-cuts, so they have enough room to stand
			. place shrouded AVR-ISP jack on the back-left edge of the bottom-board, under the same edge-cut as the capacitors
			. SD-card should be in the center of the front-panel
			. double-check the SD-card's footprint against its datasheet (its stabilization-holes were kind of wonky on the alpha prototype)
			. individually label the pins on the "MIDI-EXPANDER" header
			. move POWER-LED to center of bottom-board, and use a high-brightness white LED with a very wide visibility-cone
		. top-board:
			. remember to include edge-cuts for: the MIDI ports, the electrolytic capacitors, and the AVR-ISP port

	. double-check that the text diagrams in button-key.txt accurately reflect the finalized LED-placement

	. make a list of every part needed for the prototype, with each part's specific part-number (both manufacturer and distributor)
		. 2mm LED-standoffs
		. regular standoffs for circuit-boards, and associated screws
		. longer screws for the two top-back screw-holes, since these will have several additional layers of enclosure to cover the MIDI ports
		. small screws and nuts, for securing the heatsinks to the regulators and their underlying circuit-board
		. 5v regulator: L7805ABV
		. 3.3v regulator:
		. heatsinks for TO-220-shaped regulators!
		. B3F-5050 buttons (these have a longer life than B3F-4050 buttons)
			. use different-color button-caps on the note-keys, to differentiate between "white notes" and "black notes" like on a piano
			. use different button-cap color for control-row?
		. electrolytic capacitors: 5mm width, 2.5mm pin-width
		. 20pF capacitors: SR211A200JAR (5.08mm length)
		. 0.1uF capacitors: K104K15X7RF53H5 (5mm length)
		. resistors!
		. LEDs:
		. LSET-resistor:
		. 16Mhz crystal oscillator: FOXSLF/160-20e ("C4ST", formerly HC49SLF) (11.35mm length, 4.65mm width)
		. look into power-cables with a right-angle plug, since the DC-power port has been moved to the left side
		. ATMEGA328P-PU chips, /not/ ATMEGA328-PU chips. only ATMEGA328P-PU can be easily reprogrammed by the end-user
			. get these from DigiKey, using the "preprogrammed chip" service, to make sure the preprogrammed-bootloader-and-firmware process works
		. sockets!
		. grounding-bracelets, to use while soldering beta prototypes, and while assembling finished units
		. "industrial-grade" SD-cards: these will greatly lengthen the SD-card's wear-leveling life to something a user would be okay with
			. something like "1GB THEMIS-A" in here: http://www.psism.com/industrialsd.htm
			. sdfat /should/ support the FAT16 filesystems of the smaller THEMIS cards, but make sure this is indeed the case
			. when ordering these, make sure that the SD-cards are shipped in a state identical to what results from the SD Association formatter utility
		. look into sticky rubber spacers for the bottom of the device, to keep its screws from scraping on things and being worn down
			. mouser part: 517-SJ-5306CL ?
		. make entries for all other parts

	. redo all Inkscape files for enclosure, making sure to retake all measurements & repeat the KiCad-to-Inkscape vector paste process
		. make the tabs and slots for the bottom half of the side-panels the correct width for the plexiglass
		. tabulate the heights of all internal components, to figure out how many layers of plexiglass need to go into the "bump" above the MIDI-ports

	==== HARDWARE BETA THRESHOLD ====

	. make sure that you order the ATMEGA chips with the proper bootloader fuse config (along with the firmware), or else they will be 8 times too slow and incapable of sending MIDI
		. buy a test-batch that are preprogrammed in such a way, and slot one into a Tine beta unit for testing

	. stress-test both MIDI-INDICATOR LEDs simultaneously, with heavy simultaneous IN/OUT signals (with OUT plugged into two devices), and with the main LED-screen fully illuminated, to make sure the unit isn't prone to brownouts
		. if brownout does occur, then increase the uF value on the 5v regulator-assembly's capacitors

	. if working with an SD-card distributor: get a copy of the authorization letter that certifies the relationship with the brand they're selling
		. also: get the upstream brand to confirm the distribution relationship
	. make sure to buy extra SD-cards in case people need replacements

	. order all parts by copy-pasting part-names from the master parts-list, to avoid mental errors (like missing the inner second "P" in "ATMEGA328P-PU")

	. every unit should have its own serial-number written onto a sticker somewhere on its circuit-board

Packaging:

	. look into services that create custom-printed, custom-sized cardboard boxes
		. any DIY kits will have to be sealed tightly so parts don't escape during transport
			. will just have to use plastic baggies for this probably
				. look into bulk suppliers for non-static plastic baggies
		. fully-assembled units won't need baggies, but will still need a way to retain loose elements (stickers, manual, et al)

	. look into custom stickers and various other goodies
